<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="com.devlink.network.model.NetMapper">
 	<resultMap id="MemberResult" type="com.devlink.dao.Member">
		<result column="m_no" property="m_no" />
		<result column="id" property="id" />
		<result column="pwd" property="pwd" />
		<result column="joindate" property="joindate" />
		<result column="outdate" property="outdate" />
		<result column="name" property="name" />
		<result column="address" property="address" />
		<result column="email" property="email" />
		<result column="phone" property="phone" />
		<result column="headline" property="headline"/>
		<result column="path" property="path"/>
	</resultMap>
	<resultMap id="FrdResult" type="com.devlink.dao.Frd">
		<result column="m_no" property="m_no"/>
		<result column="name" property="name"/>
		<result column="path" property ="path"/>
	</resultMap>
	
	<select id="selectFrdTo" resultMap="FrdResult" parameterType="String">
	SELECT m.m_no, m.name, m.path
	FROM member m, frd f
	WHERE f.frd_to=#{no}
	AND f.frd_status=1
	AND f.frd_from=m.m_no
	</select>
	<select id="selectFrdFrom" resultMap="FrdResult" parameterType="String">
	SELECT m.m_no, m.name, m.path
	FROM member m, frd f
	WHERE f.frd_from=#{no}
	AND f.frd_status=1
	AND f.frd_to=m.m_no
	</select>
	<select id="selectFrdP" resultMap="FrdResult" parameterType="String">
	SELECT *
	FROM (
	SELECT m.m_no, m.name, m.path
	FROM member m, frd f
	WHERE f.frd_from in (SELECT m.m_no
	FROM member m, frd f
	WHERE f.frd_from=#{no}
	AND f.frd_to=m.m_no
	UNION
	SELECT m.m_no
	FROM member m, frd f
	WHERE f.frd_to=#{no}
	AND f.frd_from=m.m_no)
	AND f.frd_status=2
	AND f.frd_to=m.m_no
	UNION
	SELECT m.m_no, m.name, m.path
	FROM member m, frd f
	WHERE f.frd_to in (SELECT m.m_no
	FROM member m, frd f
	WHERE f.frd_from=#{no}
	AND f.frd_to=m.m_no
	UNION
	SELECT m.m_no
	FROM member m, frd f
	WHERE f.frd_to=#{no}
	AND f.frd_from=m.m_no)
	AND f.frd_status=2
	AND f.frd_from=m.m_no
	UNION
	SELECT m.m_no,m.name,m.path
	FROM member m, profile p
	WHERE p.m_no=m.m_no
	AND p.pr_kind=2
	AND REGEXP_LIKE (p.pr_title ,(SELECT pr_title FROM (SELECT pr_title, rownum n FROM profile WHERE pr_kind=2 AND m_no=#{no}) WHERE n=1)||
								 (SELECT pr_title FROM (SELECT pr_title, rownum n FROM profile WHERE pr_kind=2 AND m_no=#{no}) WHERE n=2)||
								 (SELECT pr_title FROM (SELECT pr_title, rownum n FROM profile WHERE pr_kind=2 AND m_no=#{no}) WHERE n=3)))
	WHERE m_no NOT IN #{no}
	AND m_no NOT IN (SELECT m.m_no
	FROM member m, frd f
	WHERE f.frd_from=#{no}
	AND f.frd_to=m.m_no
	UNION
	SELECT m.m_no
	FROM member m, frd f
	WHERE f.frd_to=#{no}
	AND f.frd_from=m.m_no)
	</select>
	<select id="selectFrd" resultMap="FrdResult" parameterType="String">
	SELECT m.m_no, m.name, m.path
	FROM member m, frd f
	WHERE f.frd_from=#{no}
	AND f.frd_status=2
	AND f.frd_to=m.m_no
	UNION
	SELECT m.m_no, m.name, m.path
	FROM member m, frd f
	WHERE f.frd_to=#{no}
	AND f.frd_status=2
	AND f.frd_from=m.m_no
	</select>
	<select id="selectFrdAll" resultMap="FrdResult" parameterType="String">
	SELECT m_no,name,path
	FROM member m
	WHERE m_no NOT IN #{no}
	AND m_no NOT IN (
	SELECT m.m_no
	FROM member m, frd f
	WHERE f.frd_from=#{no}
	AND f.frd_to=m.m_no
	UNION
	SELECT m.m_no
	FROM member m, frd f
	WHERE f.frd_to=#{no}
	AND f.frd_from=m.m_no)
	</select>
</mapper>